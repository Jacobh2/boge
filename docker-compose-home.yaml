version: "3"
services:
  mqtt:
    image: eclipse-mosquitto
    container_name: mqtt
    volumes:
      - ./mosquitto/config:/mosquitto/config
      - ./mosquitto/data:/mosquitto/data
      - ./mosquitto/log:/mosquitto/log
    restart: always
    network_mode: host

  home:
    image: ghcr.io/home-assistant/home-assistant:stable
    container_name: homeassistant
    privileged: true
    environment:
      - TZ=Europe/Stockholm
    volumes:
      - ./home_assistant_config:/config
      - /run/dbus:/run/dbus:ro
    restart: always
    network_mode: host

  relay:
    build: sensors
    command: [tail, -f, /dev/null]
    privileged: true
    restart: always
    environment:
      - MQTT_BROKER=mqtt
      - MQTT_PORT=1883
      - MQTT_TOPIC=homeassistant/relay/pump_001/state
      - MQTT_CLIENT_ID=pump_001
      - MQTT_USER=sensors
    env_file:
      - .env
